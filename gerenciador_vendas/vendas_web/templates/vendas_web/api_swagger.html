<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Documentation - Dashboard Comercial</title>
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui.css" />
    <style>
        html {
            box-sizing: border-box;
            overflow: -moz-scrollbars-vertical;
            overflow-y: scroll;
        }
        *, *:before, *:after {
            box-sizing: inherit;
        }
        body {
            margin:0;
            background: #fafafa;
        }
        .swagger-ui .topbar {
            background-color: #1F3D59;
        }
        .swagger-ui .topbar .download-url-wrapper .select-label {
            color: white;
        }
        .custom-header {
            background: linear-gradient(135deg, #1F3D59, #2a4f73);
            color: white;
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
        }
        .custom-header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 300;
        }
        .custom-header p {
            margin: 0.5rem 0 0 0;
            font-size: 1.1rem;
            opacity: 0.9;
        }
        .info-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            max-width: 1200px;
            margin: 0 auto 2rem;
            padding: 0 1rem;
        }
        .info-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #1F3D59;
        }
        .info-card h3 {
            margin: 0 0 0.5rem 0;
            color: #1F3D59;
            font-size: 1.2rem;
        }
        .info-card p {
            margin: 0;
            color: #666;
            line-height: 1.5;
        }
        .endpoints-list {
            list-style: none;
            padding: 0;
            margin: 0.5rem 0 0 0;
        }
        .endpoints-list li {
            background: #f8f9fa;
            margin: 0.25rem 0;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.9rem;
        }
        .method-get { border-left: 4px solid #28a745; }
        .method-post { border-left: 4px solid #007bff; }
        .method-put { border-left: 4px solid #ffc107; }
        .method-delete { border-left: 4px solid #dc3545; }
    </style>
</head>
<body>
    <div class="custom-header">
        <h1>üöÄ API Dashboard Comercial</h1>
        <p>Documenta√ß√£o interativa e completa da API</p>
    </div>

    <div class="info-cards">
        <div class="info-card">
            <h3>üìã APIs P√∫blicas (Registro/Atualiza√ß√£o)</h3>
            <p>Endpoints para criar e atualizar dados. N√£o requerem autentica√ß√£o.</p>
            <ul class="endpoints-list">
                <li class="method-post">POST /api/leads/registrar/</li>
                <li class="method-post">POST /api/leads/atualizar/</li>
                <li class="method-post">POST /api/prospectos/registrar/</li>
                <li class="method-post">POST /api/prospectos/atualizar/</li>
                <li class="method-post">POST /api/historicos/registrar/</li>
                <li class="method-post">POST /api/historicos/atualizar/</li>
            </ul>
        </div>

        <div class="info-card">
            <h3>üîç APIs de Consulta</h3>
            <p>Endpoints para consultar dados. Requerem autentica√ß√£o.</p>
            <ul class="endpoints-list">
                <li class="method-get">GET /api/consultar/leads/</li>
                <li class="method-get">GET /api/consultar/historicos/</li>
            </ul>
        </div>

        <div class="info-card">
            <h3>üìä APIs do Dashboard</h3>
            <p>Endpoints para dados do dashboard. Requerem autentica√ß√£o.</p>
            <ul class="endpoints-list">
                <li class="method-get">GET /api/dashboard/data/</li>
                <li class="method-get">GET /api/dashboard/charts/</li>
                <li class="method-get">GET /api/dashboard/prospectos/</li>
            </ul>
        </div>

        <div class="info-card">
            <h3>üí∞ APIs de Vendas</h3>
            <p>Endpoints para valida√ß√£o de vendas. Requerem autentica√ß√£o.</p>
            <ul class="endpoints-list">
                <li class="method-post">POST /api/vendas/aprovar/</li>
                <li class="method-post">POST /api/vendas/rejeitar/</li>
                <li class="method-get">GET /api/vendas/historico-contatos/</li>
            </ul>
        </div>

        <div class="info-card">
            <h3>üîß Caracter√≠sticas Especiais</h3>
            <p>Recursos avan√ßados do sistema:</p>
            <ul style="margin-top: 0.5rem;">
                <li>‚úÖ Status configur√°veis via admin</li>
                <li>‚úÖ Logs autom√°ticos de todas opera√ß√µes</li>
                <li>‚úÖ Relacionamentos autom√°ticos via id_hubsoft</li>
                <li>‚úÖ Suporte a m√∫ltiplos formatos de data</li>
                <li>‚úÖ Valida√ß√£o de dados robusta</li>
            </ul>
        </div>

        <div class="info-card">
            <h3>üìö Recursos Adicionais</h3>
            <p>Links √∫teis para desenvolvedores:</p>
            <ul style="margin-top: 0.5rem;">
                <li><a href="{% url 'vendas_web:api_documentation' %}" target="_blank">üìñ Documenta√ß√£o Completa</a></li>
                <li><a href="/admin/" target="_blank">‚öôÔ∏è Django Admin</a></li>
                <li><a href="{% url 'vendas_web:dashboard1' %}" target="_blank">üìä Dashboard</a></li>
            </ul>
        </div>
    </div>

    <div id="swagger-ui"></div>

    <script src="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui-bundle.js"></script>
    <script src="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui-standalone-preset.js"></script>
    <script>
        window.onload = function() {
            const spec = {
                "openapi": "3.0.3",
                "info": {
                    "title": "Dashboard Comercial API",
                    "description": "API completa para gerenciamento de leads, prospectos e hist√≥rico de contatos",
                    "version": "1.0.0",
                    "contact": {
                        "name": "Suporte API",
                        "email": "suporte@dashhboard.com"
                    }
                },
                "servers": [
                    {
                        "url": window.location.origin,
                        "description": "Servidor atual"
                    }
                ],
                "tags": [
                    {
                        "name": "Leads",
                        "description": "Opera√ß√µes com leads"
                    },
                    {
                        "name": "Prospectos", 
                        "description": "Opera√ß√µes com prospectos"
                    },
                    {
                        "name": "Hist√≥rico",
                        "description": "Opera√ß√µes com hist√≥rico de contatos"
                    },
                    {
                        "name": "Dashboard",
                        "description": "APIs do dashboard"
                    },
                    {
                        "name": "Vendas",
                        "description": "Valida√ß√£o de vendas"
                    },
                    {
                        "name": "Sistema",
                        "description": "Utilit√°rios do sistema"
                    }
                ],
                "paths": {
                    "/api/leads/registrar/": {
                        "post": {
                            "tags": ["Leads"],
                            "summary": "Registrar novo lead",
                            "description": "Cria um novo lead no sistema",
                            "requestBody": {
                                "required": true,
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "$ref": "#/components/schemas/LeadCreateRequest"
                                        }
                                    }
                                }
                            },
                            "responses": {
                                "201": {
                                    "description": "Lead criado com sucesso",
                                    "content": {
                                        "application/json": {
                                            "schema": {
                                                "$ref": "#/components/schemas/LeadResponse"
                                            }
                                        }
                                    }
                                },
                                "400": {
                                    "description": "Dados inv√°lidos",
                                    "content": {
                                        "application/json": {
                                            "schema": {
                                                "$ref": "#/components/schemas/ErrorResponse"
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "/api/leads/atualizar/": {
                        "post": {
                            "tags": ["Leads"],
                            "summary": "Atualizar lead existente",
                            "description": "Atualiza um lead existente usando filtros din√¢micos",
                            "requestBody": {
                                "required": true,
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "$ref": "#/components/schemas/LeadUpdateRequest"
                                        }
                                    }
                                }
                            },
                            "responses": {
                                "200": {
                                    "description": "Lead atualizado com sucesso",
                                    "content": {
                                        "application/json": {
                                            "schema": {
                                                "$ref": "#/components/schemas/LeadResponse"
                                            }
                                        }
                                    }
                                },
                                "404": {
                                    "description": "Lead n√£o encontrado"
                                },
                                "400": {
                                    "description": "Dados inv√°lidos"
                                }
                            }
                        }
                    },
                    "/api/prospectos/registrar/": {
                        "post": {
                            "tags": ["Prospectos"],
                            "summary": "Registrar novo prospecto",
                            "description": "Cria um novo prospecto no sistema",
                            "requestBody": {
                                "required": true,
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "$ref": "#/components/schemas/ProspectoCreateRequest"
                                        }
                                    }
                                }
                            },
                            "responses": {
                                "201": {
                                    "description": "Prospecto criado com sucesso"
                                },
                                "400": {
                                    "description": "Dados inv√°lidos"
                                }
                            }
                        }
                    },
                    "/api/prospectos/atualizar/": {
                        "post": {
                            "tags": ["Prospectos"],
                            "summary": "Atualizar prospecto existente",
                            "description": "Atualiza um prospecto existente usando filtros din√¢micos",
                            "requestBody": {
                                "required": true,
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "$ref": "#/components/schemas/ProspectoUpdateRequest"
                                        }
                                    }
                                }
                            },
                            "responses": {
                                "200": {
                                    "description": "Prospecto atualizado com sucesso"
                                },
                                "404": {
                                    "description": "Prospecto n√£o encontrado"
                                }
                            }
                        }
                    },
                    "/api/historicos/registrar/": {
                        "post": {
                            "tags": ["Hist√≥rico"],
                            "summary": "Registrar hist√≥rico de contato",
                            "description": "Cria um novo registro de hist√≥rico de contato",
                            "requestBody": {
                                "required": true,
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "$ref": "#/components/schemas/HistoricoCreateRequest"
                                        }
                                    }
                                }
                            },
                            "responses": {
                                "201": {
                                    "description": "Hist√≥rico criado com sucesso"
                                },
                                "400": {
                                    "description": "Dados inv√°lidos"
                                }
                            }
                        }
                    },
                    "/api/verificar-relacionamentos/": {
                        "post": {
                            "tags": ["Sistema"],
                            "summary": "Verificar relacionamentos autom√°ticos",
                            "description": "Verifica e cria relacionamentos entre leads e prospectos baseado no id_hubsoft",
                            "requestBody": {
                                "required": true,
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "object"
                                        }
                                    }
                                }
                            },
                            "responses": {
                                "200": {
                                    "description": "Verifica√ß√£o conclu√≠da",
                                    "content": {
                                        "application/json": {
                                            "schema": {
                                                "type": "object",
                                                "properties": {
                                                    "success": {"type": "boolean"},
                                                    "relacionamentos_criados": {"type": "integer"},
                                                    "message": {"type": "string"}
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "/api/consultar/leads/": {
                        "get": {
                            "tags": ["Leads"],
                            "summary": "Consultar leads",
                            "description": "Consulta leads com filtros e pagina√ß√£o. Requer autentica√ß√£o.",
                            "security": [{"sessionAuth": []}],
                            "parameters": [
                                {
                                    "name": "search",
                                    "in": "query",
                                    "description": "Busca por nome, email, telefone, empresa",
                                    "schema": {"type": "string"}
                                },
                                {
                                    "name": "origem",
                                    "in": "query",
                                    "description": "Filtro por origem",
                                    "schema": {
                                        "type": "string",
                                        "enum": ["site", "facebook", "instagram", "google", "whatsapp", "indicacao", "telefone", "email", "outros"]
                                    }
                                },
                                {
                                    "name": "status_api",
                                    "in": "query",
                                    "description": "Filtro por status (configur√°vel via admin)",
                                    "schema": {"type": "string"}
                                },
                                {
                                    "name": "ativo",
                                    "in": "query",
                                    "description": "Filtro por status ativo",
                                    "schema": {"type": "boolean"}
                                },
                                {
                                    "name": "page",
                                    "in": "query",
                                    "description": "N√∫mero da p√°gina",
                                    "schema": {"type": "integer", "default": 1}
                                },
                                {
                                    "name": "per_page",
                                    "in": "query",
                                    "description": "Itens por p√°gina",
                                    "schema": {"type": "integer", "default": 20, "maximum": 100}
                                }
                            ],
                            "responses": {
                                "200": {
                                    "description": "Lista de leads",
                                    "content": {
                                        "application/json": {
                                            "schema": {
                                                "$ref": "#/components/schemas/LeadListResponse"
                                            }
                                        }
                                    }
                                },
                                "401": {
                                    "description": "N√£o autenticado"
                                }
                            }
                        }
                    },
                    "/api/dashboard/data/": {
                        "get": {
                            "tags": ["Dashboard"],
                            "summary": "Dados principais do dashboard",
                            "description": "Retorna m√©tricas principais: atendimentos, leads, prospectos, vendas",
                            "security": [{"sessionAuth": []}],
                            "responses": {
                                "200": {
                                    "description": "Dados do dashboard",
                                    "content": {
                                        "application/json": {
                                            "schema": {
                                                "$ref": "#/components/schemas/DashboardDataResponse"
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "/api/vendas/aprovar/": {
                        "post": {
                            "tags": ["Vendas"],
                            "summary": "Aprovar venda",
                            "description": "Aprova uma venda de prospecto",
                            "security": [{"sessionAuth": []}],
                            "requestBody": {
                                "required": true,
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "object",
                                            "required": ["prospecto_id", "observacoes"],
                                            "properties": {
                                                "prospecto_id": {"type": "integer"},
                                                "observacoes": {"type": "string"}
                                            }
                                        }
                                    }
                                }
                            },
                            "responses": {
                                "200": {
                                    "description": "Venda aprovada com sucesso"
                                },
                                "400": {
                                    "description": "Dados inv√°lidos"
                                },
                                "404": {
                                    "description": "Prospecto n√£o encontrado"
                                }
                            }
                        }
                    }
                },
                "components": {
                    "securitySchemes": {
                        "sessionAuth": {
                            "type": "apiKey",
                            "in": "cookie",
                            "name": "sessionid",
                            "description": "Cookie de sess√£o do Django. Fa√ßa login em /admin/login/ primeiro."
                        }
                    },
                    "schemas": {
                        "LeadCreateRequest": {
                            "type": "object",
                            "required": ["nome_razaosocial", "telefone"],
                            "properties": {
                                "nome_razaosocial": {
                                    "type": "string",
                                    "description": "Nome ou raz√£o social",
                                    "example": "Maria Silva"
                                },
                                "telefone": {
                                    "type": "string",
                                    "description": "Telefone com c√≥digo do pa√≠s",
                                    "example": "+5585999999999"
                                },
                                "email": {
                                    "type": "string",
                                    "format": "email",
                                    "example": "maria@exemplo.com"
                                },
                                "origem": {
                                    "type": "string",
                                    "enum": ["site", "facebook", "instagram", "google", "whatsapp", "indicacao", "telefone", "email", "outros"],
                                    "default": "site"
                                },
                                "valor": {
                                    "type": "number",
                                    "format": "decimal",
                                    "example": 1500.50
                                },
                                "empresa": {
                                    "type": "string",
                                    "example": "Empresa ABC"
                                },
                                "id_hubsoft": {
                                    "type": "string",
                                    "description": "ID para relacionamento autom√°tico",
                                    "example": "HUB123"
                                },
                                "status_api": {
                                    "type": "string",
                                    "description": "Status configur√°vel via admin",
                                    "default": "pendente"
                                },
                                "data_nascimento": {
                                    "type": "string",
                                    "description": "Data em formato DD/MM/YYYY ou YYYY-MM-DD",
                                    "example": "14/11/1985"
                                }
                            }
                        },
                        "LeadUpdateRequest": {
                            "type": "object",
                            "required": ["termo_busca", "busca"],
                            "properties": {
                                "termo_busca": {
                                    "type": "string",
                                    "description": "Campo para filtrar",
                                    "example": "id_hubsoft"
                                },
                                "busca": {
                                    "description": "Valor a buscar",
                                    "example": "HUB123"
                                },
                                "status_api": {
                                    "type": "string",
                                    "example": "processado"
                                },
                                "score_qualificacao": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 10,
                                    "example": 8
                                }
                            }
                        },
                        "ProspectoCreateRequest": {
                            "type": "object",
                            "required": ["nome_prospecto"],
                            "properties": {
                                "nome_prospecto": {
                                    "type": "string",
                                    "example": "Jo√£o da Silva"
                                },
                                "lead": {
                                    "type": "integer",
                                    "description": "ID do lead relacionado",
                                    "example": 123
                                },
                                "id_prospecto_hubsoft": {
                                    "type": "string",
                                    "example": "HUB123"
                                },
                                "status": {
                                    "type": "string",
                                    "description": "Status configur√°vel via admin",
                                    "default": "pendente"
                                },
                                "prioridade": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "maximum": 5,
                                    "default": 1
                                },
                                "score_conversao": {
                                    "type": "number",
                                    "format": "decimal",
                                    "minimum": 0,
                                    "maximum": 100,
                                    "example": 75.5
                                }
                            }
                        },
                        "ProspectoUpdateRequest": {
                            "type": "object",
                            "required": ["termo_busca", "busca"],
                            "properties": {
                                "termo_busca": {
                                    "type": "string",
                                    "example": "id_prospecto_hubsoft"
                                },
                                "busca": {
                                    "example": "HUB123"
                                },
                                "status": {
                                    "type": "string",
                                    "example": "processando"
                                }
                            }
                        },
                        "HistoricoCreateRequest": {
                            "type": "object",
                            "required": ["telefone", "status"],
                            "properties": {
                                "telefone": {
                                    "type": "string",
                                    "example": "+5585988887777"
                                },
                                "status": {
                                    "type": "string",
                                    "description": "Status configur√°vel via admin",
                                    "example": "fluxo_inicializado"
                                },
                                "lead": {
                                    "type": "integer",
                                    "example": 123
                                },
                                "nome_contato": {
                                    "type": "string",
                                    "example": "Jo√£o"
                                },
                                "duracao_segundos": {
                                    "type": "integer",
                                    "example": 42
                                },
                                "sucesso": {
                                    "type": "boolean",
                                    "default": false
                                }
                            }
                        },
                        "LeadResponse": {
                            "type": "object",
                            "properties": {
                                "success": {"type": "boolean"},
                                "id": {"type": "integer"},
                                "lead": {
                                    "type": "object",
                                    "properties": {
                                        "id": {"type": "integer"},
                                        "nome_razaosocial": {"type": "string"},
                                        "telefone": {"type": "string"},
                                        "status_api": {"type": "string"},
                                        "status_api_display": {"type": "string"},
                                        "origem_display": {"type": "string"},
                                        "data_cadastro": {"type": "string", "format": "date-time"}
                                    }
                                }
                            }
                        },
                        "LeadListResponse": {
                            "type": "object",
                            "properties": {
                                "results": {
                                    "type": "array",
                                    "items": {"$ref": "#/components/schemas/LeadResponse/properties/lead"}
                                },
                                "total": {"type": "integer"},
                                "page": {"type": "integer"},
                                "per_page": {"type": "integer"},
                                "pages": {"type": "integer"}
                            }
                        },
                        "DashboardDataResponse": {
                            "type": "object",
                            "properties": {
                                "stats": {
                                    "type": "object",
                                    "properties": {
                                        "atendimentos": {"type": "integer"},
                                        "leads": {"type": "integer"},
                                        "prospectos": {"type": "integer"},
                                        "vendas": {"type": "integer"},
                                        "atendimentos_variacao": {"type": "string"},
                                        "leads_variacao": {"type": "string"},
                                        "prospectos_variacao": {"type": "string"},
                                        "vendas_variacao": {"type": "string"}
                                    }
                                }
                            }
                        },
                        "ErrorResponse": {
                            "type": "object",
                            "properties": {
                                "error": {
                                    "type": "string",
                                    "example": "Campos obrigat√≥rios ausentes: nome_razaosocial, telefone"
                                }
                            }
                        }
                    }
                }
            };

            SwaggerUIBundle({
                url: '',
                spec: spec,
                dom_id: '#swagger-ui',
                deepLinking: true,
                presets: [
                    SwaggerUIBundle.presets.apis,
                    SwaggerUIStandalonePreset
                ],
                plugins: [
                    SwaggerUIBundle.plugins.DownloadUrl
                ],
                layout: "StandaloneLayout",
                tryItOutEnabled: true,
                requestInterceptor: (request) => {
                    // Adicionar CSRF token se necess√°rio
                    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
                    if (csrfToken) {
                        request.headers['X-CSRFToken'] = csrfToken.value;
                    }
                    return request;
                }
            });
        };
    </script>
</body>
</html>
